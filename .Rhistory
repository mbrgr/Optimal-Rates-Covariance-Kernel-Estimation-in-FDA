labs(title = "n = 400")
library(ggplot2)
bw_comparison_tbl |>
filter(n != 50) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = n, linetype = p), size = .6) +
ylim(c(0, 0.65)) +
theme(text = element_text(size = 18))
library(tidyverse)
bw_comparison_tbl = Reduce(rbind, bw_comparison) |>
as_tibble() |>
rename(n = V1, p = V2, h = V3, sup.err = V4) |>
mutate(p = as.factor(p), n = as.factor(n))
bw_comparison_tbl |>
filter(n != 50) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = n, linetype = p), size = .6) +
ylim(c(0, 0.65)) +
theme(text = element_text(size = 18))
# Figure 3:
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = p, linetype = p), size = .6) +
ylim(c(0.02, 0.52)) +
theme(text = element_text(size = 18)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, linetype = p), size = .6) +
ylim(c(0.02, 0.52)) +
theme(text = element_text(size = 18)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, linetype = p), size = .6) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, linetype = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
ggsave("Grafics/cov_optimal_bw_n400.png", device = "png", width = 5, height = 3.8, units = "in")
bw_comparison_tbl |>
filter(n == 100, p == 75) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, linetype = p)) +
ylim(c(0, 0.9))
min_h_tibble = bw_comparison_tbl |>
group_by(n, p) |>
slice_min(sup.err)
bw_comparison_tbl |>
filter(n == 100) |>
ggplot( ) +
geom_line(aes(x = h, y = sup.err, col = p, linetype = p)) +
ylim(c(0.03, 0.65)) +
labs(title = "n = 100")
##### One -Fold CV #####
# not in paper
load("data/one_fold_cv_n400_OU.RData")
one_fold_tbl_n400 = tibble(h = one_fold_cv_n400 %>% unlist(), p = gl(3, 1000, labels = p.seq))
one_fold_tbl_n400 %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot()
n400_table = one_fold_tbl_n400 %>%
group_by_all() %>%
summarise(n = n()/1000)
n400_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p)
one_fold_tbl_n400 %>%
summarise(.by = p, mean(h))
##### five fold cv #####
load("data/five_fold_cv_OU.RData")
five_fold_tbl = tibble(h = five_fold_cv %>% unlist(), p = gl(5, 1000, labels = p.seq))
five_fold_tbl %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot()
five_fold_table = five_fold_tbl %>%
group_by_all() %>%
summarise(n = n()/1000)
# Figure in Appendix
five_fold_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p) +
ylab(NULL) +
labs(title = "n = 100")
##### five fold cv #####
load("data/five_fold_cv_OU.RData")
five_fold_tbl = tibble(h = five_fold_cv %>% unlist(), p = gl(5, 1000, labels = p.seq))
five_fold_tbl = tibble(h = five_fold_cv_n400 %>% unlist(), p = gl(5, 1000, labels = p.seq))
five_fold_tbl %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot()
# Figure in Appendix
five_fold_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p) +
ylab(NULL) +
labs(title = "n = 100")
##### five fold cv #####
# In Paper
five_fold_tbl_n400 = tibble(h = five_fold_cv_n400 %>% unlist(), p = gl(5, 1000, labels = p.seq))
# Figure 4
five_fold_tbl_n400 %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot(size = .6) +
labs(title = "n = 400") +
theme(text = element_text(size = 18))
# Figure 4
five_fold_tbl_n400 %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot(size = .6) +
labs(title = "n = 400") #+
# theme(text = element_text(size = 18))
ggsave("Grafics/cov_5fcv_bw_n400.png", device = "png", width = 5, height = 3.8, units = "in")
five_fold_table_n400 = five_fold_tbl_n400 %>%
group_by_all() %>%
summarise(n = n()/1000)
# Figure 5
five_fold_table_n400 %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
facet_wrap(.~p, nrow = 1) +
ylab(NULL) +
labs(title = "n = 400") +
theme(text = element_text(size = 18))
#  theme(text = element_text(size = 18))
ggsave("Grafics/cov_5fcv_bw_n400_table.png", device = "png", width = 5, height = 3.8, units = "in")
# Figure in Appendix
five_fold_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p) +
ylab(NULL) +
labs(title = "n = 100")
##### five fold cv #####
load("data/five_fold_cv_OU.RData")
View(five_fold_cv_n400)
View(error_decomp_tbl)
load("C:/Users/mberger.PC12599/HESSENBOX/GitHub/Optimal-Rates-Covariance-Kernel-Estimation-in-FDA/data/bw_comp_OU.RData")
n400_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p)
##### One -Fold CV #####
# not in paper
load("data/one_fold_cv_n400_OU.RData")
n400_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p)
##### One -Fold CV #####
# not in paper
load("data/one_fold_cv_n400_OU.RData")
one_fold_tbl_n400 = tibble(h = one_fold_cv_n400 %>% unlist(), p = gl(3, 1000, labels = p.seq))
one_fold_tbl_n400 %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot()
n400_table = one_fold_tbl_n400 %>%
group_by_all() %>%
summarise(n = n()/1000)
n400_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p)
one_fold_tbl_n400 %>%
summarise(.by = p, mean(h))
load("data/bw_comp_OU.RData")
bw_comparison_tbl = Reduce(rbind, bw_comparison) |>
as_tibble() |>
rename(n = V1, p = V2, h = V3, sup.err = V4) |>
mutate(p = as.factor(p), n = as.factor(n))
bw_comparison_tbl |>
filter(n != 50) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = n, linetype = p), size = .6) +
ylim(c(0, 0.65)) +
theme(text = element_text(size = 18))
# Figure 3:
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = p, linetype = p), size = .6) +
ylim(c(0.02, 0.52)) +
theme(text = element_text(size = 18)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 100, p == 75) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, linetype = p)) +
ylim(c(0, 0.9))
min_h_tibble = bw_comparison_tbl |>
group_by(n, p) |>
slice_min(sup.err)
bw_comparison_tbl |>
filter(n == 100) |>
ggplot( ) +
geom_line(aes(x = h, y = sup.err, col = p, linetype = p)) +
ylim(c(0.03, 0.65)) +
labs(title = "n = 100")
# Figure 3:
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_line(aes(x = h, y = sup.err, col = p, linetype = p), size = .6) +
ylim(c(0.02, 0.52)) +
theme(text = element_text(size = 18)) +
labs(title = "n = 400")
bw_comparison_tbl |>
filter(n == 400) |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim(c(0.02, 0.52)) +
labs(title = "n = 400")
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim(c(0.02, 0.52)) +
facet_wrap(n~.)
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
facet_wrap(n~.)
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
facet_wrap(n~., nrow = 1)
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
ylim = c(0, 1)
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
lims(y = c(0, 1)) +
facet_wrap(n~., nrow = 1)
# add: dissertation
bw_comparison_tbl |>
ggplot() +
geom_point(aes(x = h, y = sup.err, col = p, pch = p)) +
lims(y = c(0, .95)) +
facet_wrap(n~., nrow = 1)
ggsave("Grafics/cov_optimal_bw_various_n.png", device = "png", width = 8, height = 4, units = "in")
##### five fold cv #####
load("data/five_fold_cv_OU.RData")
five_fold_tbl = tibble(h = five_fold_cv %>% unlist(), p = gl(5, 1000, labels = p.seq))
five_fold_tbl %>%
ggplot(aes(y = h, x = p, col = p)) +
geom_boxplot()
five_fold_table = five_fold_tbl %>%
group_by_all() %>%
summarise(n = n()/1000)
# Figure in Appendix
five_fold_table %>%
ggplot(aes(h, n)) +
geom_point(size = 3) +
ylim(c(0, 0.1))+
facet_wrap(.~p) +
ylab(NULL) +
labs(title = "n = 100")
#### Estimator Comparison ####
load("data/estimator_comparison.RData")
to_tibble = function(bw_comp, est = "mir", m = 1, Z = "OU") {
Reduce(rbind, bw_comp) |>
as_tibble() |>
rename(n = V1, p = V2, h = V3, sup.err = V4) |>
mutate(p = as.factor(p),
n = as.factor(n),
estimator = est,
m = m,
Z = Z)
}
est_comp = rbind(OU_m0, OU_m1,
OU_m0_full, OU_m1_full,
OU_m2, OU_m2_full,
rv2_m0, rv2_m1,
rv2_m0_full, rv2_m1_full,
rv2_m2, rv2_m2_full) |>
mutate(estimator = as.factor(estimator),
m = as.factor(m), Z = as.factor(Z))
# Figure 8a
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, lty = estimator, col = m)) +
geom_line(size = .6) +
lims(y = c(0.03, 1.2)) +
theme(text = element_text(size = 18)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50")
# Figure 8b
est_comp |>
filter(n == 100, p == 50, Z == "2rv") |>
ggplot(aes(x = h, y = sup.err, lty = estimator, col = m)) +
geom_line(size = .6) +
lims(y = c(0.03, 1.1))+
theme(text = element_text(size = 18)) +
labs(title = "Process 2", subtitle = "n = 100, p = 50")
# Figure 8a
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, lty = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.2)) +
theme(text = element_text(size = 18)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50")
# Figure 8a
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.2)) +
theme(text = element_text(size = 18)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50")
# Figure 8a
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.2)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50")
# Figure 8b
est_comp |>
filter(n == 100, p == 50, Z == "2rv") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.1))+
theme(text = element_text(size = 18)) +
labs(title = "Process 2", subtitle = "n = 100, p = 50")
ggsave("Grafics/est_comp_OU_points.png", device = "png", width = 5, height = 3.8, units = "in")
# Figure 8a
est_comp |>
filter(n == 100, p == 50, Z == "OU") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.2)) +
labs(title = "Ornstein-Uhlenbeck", subtitle = "n = 100, p = 50")
ggsave("Grafics/est_comp_OU_points.png", device = "png", width = 5, height = 3.8, units = "in")
# Figure 8b
est_comp |>
filter(n == 100, p == 50, Z == "2rv") |>
ggplot(aes(x = h, y = sup.err, pch = estimator, col = m)) +
geom_point() +
lims(y = c(0.03, 1.1))+
labs(title = "Process 2", subtitle = "n = 100, p = 50")
ggsave("Grafics/est_comp_2rv_points.png", device = "png", width = 5, height = 3.8, units = "in")
library(plotly)
library(tidyverse)
library(biLocPol) # please install this package from Github first. See "README.md" file for instructions
##### Load Data #####
# instead of evaluating the functions all again the results can be loaded with
load("data/illustrations.RData")
##### Processes #####
# Figure of paths of the processes of the second process
# not contained in the paper
set.seed(134)
p = 40
n =  5
obs = OU(n, t = c(0,(1:p - 0.5)/p), x0 = 0)
obs_tibble = tibble(Y = as.vector(t(obs)), x = rep(c(0, (1:p - 0.5)/p), n), n = gl(n, p + 1))
obs_tibble |>
ggplot(aes(x, Y, col = n)) +
geom_line(aes(lty = n), size = .6) +
geom_point(size = .9) +
geom_abline(slope = 0, intercept = 0, lty = 4) +
labs(y = NULL, x = NULL) +
theme(legend.position = "none",
text = element_text(size = 16))
##### Figure of (empirical) covariances #####
set.seed(513)
n = 100
p = 40
x.design = (1:p - 1/2)/p
p.eval = 150
h = 0.5
# Target function: Orntein-Uhlenbeck process with following parameters:
sigma = 2; theta = 3
x = observation_grid(p.eval, comp = "full")[1:p.eval, 1]
Y = FDA_observation(n, x.design,
r.process = OU, process.arg = list(alpha = theta, sigma = sigma, x0 = 0),
eps.arg = list(sd = 0.5))
Z = observation_transformation(Y)
library(tidyverse)
library(plotly)
library(lubridate)
library(hms)
library(biLocPol) # please install this package from Github first. See "README.md" file for instructions
library(future.apply)
load("data/weather_data_raw.RData")
N$DATUM = str_split_i(N$MESS_DATUM, pattern = " ", i = 1) |> ymd()
tage = c(1, 4, 8, 12, 15, 18, 22, 25, 29)
N_full = N[-(1:6),]
N = N %>%
filter(TAG %in% tage)
N |>
filter(TAG %in% c(1, 8, 15, 22, 29)) |>
ggplot() +
geom_line(aes(x = UHRZEIT, y = TT_10, group = JAHR*TAG, colour = JAHR), alpha = .4) +
facet_wrap(MONAT ~.)
# Figure 9b: Temp. curves in August
N |>
filter(TAG %in% c(1, 15, 29),
MONAT == 8) |>
ggplot() +
geom_line(aes(x = UHRZEIT, y = TT_10, group = JAHR*TAG, colour = JAHR), alpha = .6) +
labs(y = "Temp. in C°", x = "hours", title = "Temp. in August", colour = "year") +
theme(text = element_text(size = 18))
N_wide = N |>
filter(TAG %in% tage) |>  # No consecutive days
mutate(UHRZEIT = as.character(UHRZEIT)) |>
select(JAHR, MONAT, TAG, UHRZEIT, TT_10) |>
pivot_wider(names_from = UHRZEIT,
values_from = TT_10)
Y_all = N_full |>
mutate(UHRZEIT = as.character(UHRZEIT)) |>
select(JAHR, MONAT, TAG, UHRZEIT, TT_10) |>
pivot_wider(names_from = UHRZEIT, values_from = TT_10) |>
filter(MONAT == 4) |>
select(-(1:3))
empirical_cov_all = Y_all |>
as.data.frame() |>
observation_transformation(na.rm = T, grid.type = "full")
empirical_cov_filtered = N_wide |>
filter(MONAT == 4) |>
select(-(1:3)) |>
as.data.frame() |>
observation_transformation(na.rm = T, grid.type = "full")
df_all = tibble(empirical_cov_all, empirical_cov_filtered, observation_grid(144, comp = "full"))
# grafic not contained in paper
plot_ly(df_all, size = .4) |>
add_markers(x = ~Var1, y = ~Var2, z = ~empirical_cov_all) |>
add_markers(x = ~Var1, y = ~Var2, z = ~empirical_cov_filtered, alpha = 0.4)
#### NA Count #####
N |>  summarise(.by = c(JAHR, MONAT, TAG),
n = n(), mean = mean(TT_10)) |>
filter(n == 144) |>
summarise(.by = MONAT,
n = n()) |>
arrange(MONAT)
cov_estimation = function(month, weights = W, nw =  N_wide){
y = nw |>
filter(MONAT == month) |>
select(-(1:3))
z = y |>
as.data.frame() |> # TODO: fix this in biLocPol
observation_transformation(na.rm = T)
eval_weights(weights, z)
}
N_wide |>
filter(MONAT == 3) |>
select(-(1:3)) |> is.na() |> sum()
##### calculate weights #####
p.eval = 72
W = local_polynomial_weights(144, 0.2, p.eval, T, m = 1)
N |>
filter(TAG %in% tage,
MONAT == 1) |>
ggplot() +
geom_line(aes(x = UHRZEIT, y = TT_10, group = JAHR*TAG, colour = JAHR), alpha = .6) +
labs(y = "Temp. in C°", x = "time", title = "Temp. in January", colour = "year") +
theme(text = element_text(size = 12))
ggsave("grafics/january_temp_curves.png", device = "png", width = 5, height = 4, unit = "in")
N |>
filter(TAG %in% tage,
MONAT == 7) |>
ggplot() +
geom_line(aes(x = UHRZEIT, y = TT_10, group = JAHR*TAG, colour = JAHR), alpha = .6) +
labs(y = "Temp. in C°", x = "time", title = "Temp. in July", colour = "year") +
theme(text = element_text(size = 12))
ggsave("grafics/july_temp_curves.png", device = "png", width = 5, height = 4, unit = "in")
